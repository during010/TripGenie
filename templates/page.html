<!DOCTYPE html>
<html lang="zh">

<head>
    <title>畅游济南小助手</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/headstyle.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/headstyle_weather.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
</head>

<body>
    <!-- 左侧边栏 -->
    <div class="left-sidebar" id="leftSidebar">
        <div class="toggle-sidebar" onclick="toggleSidebar()">
            <i class="fas fa-chevron-right"></i>
        </div>
        <div class="logo-section">
            <img src="static\logo.jpg" alt="Logo" class="logo">
        </div>
        <div class="sidebar-tools">
            <div class="sidebar-tool" id="newConversationBtnSide">
                <i class="fas fa-sync"></i>
                <span>开启新对话</span>
            </div>
            <div class="sidebar-tool" id="historyButton" onclick="showHistoryPage()">
                <i class="fas fa-history"></i>
                <span>历史记录</span>
            </div>
            <div class="sidebar-tool" id="publicTransportBtn">
                <i class="fas fa-bus"></i>
                <span>公共交通</span>
            </div>
            <div class="sidebar-tool" id="languageToggleBtn">
                <i class="fas fa-globe"></i>
                <span id="languageToggleText">中/英文</span>
            </div>
            <div class="sidebar-tool" id="weatherInfoBtn" onclick="showWeatherPage()">
                <i class="fas fa-cloud-sun"></i>
                <span>天气信息</span>
            </div>
            <div class="sidebar-tool theme-toggle" id="themeButton">
                <i class="fas fa-moon"></i>
                <span style="margin-left: -5px;">主题切换</span>
                <select id="themeSelect" class="theme-select" onchange="handleThemeChange()" style="display: none;">
                    <option value="light">浅色主题</option>
                    <option value="dark">深色主题</option>
                    <option value="custom">自定义背景</option>
                </select>
            </div>
        </div>


        <div class="user-settings" id="userButton">
            <!-- 人物图标：始终显示 -->
            <div class="sidebar-tool" id="userIcon" style="cursor: pointer;" onclick="toggleUserMenu()">
                <i class="fas fa-user"></i>
                <span id="displayUsername">用户名</span>

                <div id="userMenu"
                    style="display: none; position: absolute; right: 0; bottom: 100%; background: white; border: 1px solid #ccc; border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.15); z-index: 100;">
                    <div style="padding: 8px 12px; border-bottom: 1px solid #eee;">
                        用户：<span id="menuUsername" style="font-weight: bold;"></span>
                    </div>
                    <div style="padding: 8px 12px; cursor: pointer;" onclick="logout()">退出登录</div>
                </div>
            </div>
        </div>
    </div>
    <!-- 历史记录页面 -->
    <div class="history-page" id="historyPage">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
            <button class="back-button" onclick="backToMainPage()">
                <i class="fas fa-arrow-left"></i> 返回
            </button>
            <div id="userDisplay" style="padding: 8px 13px; border: 1px solid green; color: green; border-radius: 4px;">
                用户：<span id="historyUsername"></span>
            </div>
        </div>
        <h2 class="history-title">历史行程记录</h2>
        <div class="history-cards" id="historyCards">
            <!-- 历史记录卡片将通过 JavaScript 动态生成 -->
        </div>.
    </div>

    <!-- 天气信息页面 -->
    <div class="weather-page" id="weatherPage" style="display: none; padding: 20px 40px;">
        <div style="margin-bottom: 10px;">
            <button class="back-button" onclick="backToMainPage()"
                style="display: flex; align-items: center; gap: 5px;">
                <i class="fas fa-arrow-left"></i> 返回
            </button>
        </div>

        <h2 class="weather-title" style="margin: 0 0 20px 0;">天气信息</h2>

        <div class="weather-buttons" style="display: flex; gap: 20px; margin-bottom: 20px;">
            <button class="weather-btn" onclick="showWeather(7)">7天内</button>
            <button class="weather-btn" onclick="showWeather(15)">15天内</button>
        </div>

        <!-- 天气卡片容器 -->
        <div id="weatherCardsContainer" style="overflow-x: auto; white-space: nowrap;">
            <div id="weatherCards" style="display: flex; gap: 10px; "></div>
        </div>

        <!-- 折线图 -->
        <canvas id="tempChart" width="1200" height="360" style="margin-top: 30px;"></canvas>

    </div>



    <!-- 登录模态框 -->
    <div class="login-modal" id="loginModal">
        <div class="login-form">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>登录</h3>
                <button class="close-button" onclick="closeLoginModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <input type="text" id="username" placeholder="用户名">
            <input type="password" id="password" placeholder="密码">
            <button onclick="login()">登录</button>
            <div class="register-link" onclick="showRegisterModal()">注册新账号</div>
        </div>
    </div>

    <!-- 注册模态框 -->
    <div class="login-modal" id="registerModal" style="display: none;">
        <div class="login-form">
            <h3>注册</h3>
            <input type="text" id="registerUsername" placeholder="用户名">
            <input type="password" id="registerPassword" placeholder="密码">
            <input type="password" id="confirmPassword" placeholder="确认密码">
            <button onclick="register()">注册</button>
            <div class="register-link" onclick="showLoginModal()">返回登录</div>
        </div>
    </div>
    <div id="historyModal" class="confirm-modal">
        <div class="confirm-content">
            <div class="confirm-header">
                <h3 id="historyModalTitle">历史记录</h3>
                <button class="close-button" onclick="closeHistoryModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="confirm-body">
                <div id="historyContent"></div>
            </div>
            <div class="confirm-footer">
                <button class="cancel-button" onclick="closeHistoryModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 成功提示框 -->
    <div class="success-modal" id="successModal">
        <div class="success-content">
            <div class="success-header">
                <h3 id="successModalTitle">注册成功！</h3>
                <button class="close-button" onclick="closeSuccessModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="success-footer">
                <button class="success-button" onclick="closeSuccessModal()">确定</button>
            </div>
        </div>
    </div>
    <!-- 确认提示框 -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-content">
            <div class="confirm-header">
                <h3 id="confirmModalTitle"></h3>
                <button class="close-button" onclick="closeConfirmModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="confirm-body">
                <p id="confirmModalMessage">您确认要退出登录吗？</p>
            </div>
            <div class="confirm-footer">
                <button class="cancel-button" onclick="closeConfirmModal()">取消</button>
                <button class="confirm-button" onclick="confirmLogout()">确定</button>
            </div>
        </div>
    </div>


    <div id="publicTransportPage" class="content-page" style="display: none;">
        <div class="public-transport-container">
            <button class="back-button" onclick="backToMainPage()">
                <i class="fas fa-arrow-left"></i> 返回
            </button>
            <h2>济南公交线路表</h2>
            <div class="search-bar">
                <input type="text" id="routeSearch" placeholder="搜索公交线路...">
                <button onclick="searchRoute()">搜索</button>
            </div>
            <div class="bus-table-container">
                <table id="busTable" class="bus-table">
                    <thead>
                        <tr>
                            <th>线路名</th>
                            <th>起终点</th>
                            <th>运营日期</th>
                            <th>首班车时间</th>
                            <th>末班车时间</th>
                            <th>票价</th>
                            <th>折扣方式</th>
                            <th>详情</th>
                        </tr>
                    </thead>
                    <tbody id="busTableBody">
                        <!-- 动态填充数据 -->
                    </tbody>
                </table>
            </div>
            <div class="pagination-container">
                <button onclick="prevPage()" id="prevBtn">上一页</button>
                <span id="pageInfo">第 <span id="currentPage">1</span> 页 / 共 <span id="totalPages">0</span>
                    页</span>
                <button onclick="nextPage()" id="nextBtn">下一页</button>
            </div>
        </div>

        <!-- 右侧站点信息边栏 -->
        <div id="stationInfoSidebar" class="station-info-sidebar">
            <div class="station-info-header">
                <h3>站点信息</h3>
                <button id="reverseButton" onclick="reverseStations()">↑ ↓反转</button>
            </div>
            <div id="stationInfoContent"></div>
            <div class="station-info-footer">
                <button onclick="hideStationInfo()" class="close-button">关闭</button>
            </div>
        </div>
    </div>

    <!-- 主聊天区域 -->
    <div id="mainPage" class="main-content">
        <div class="chat-header">
            <h3>畅游济南小助手</h3>
            <div class="header-actions">
                <select class="language-select" id="languageSelect" onchange="toggleLanguage()">
                    <option value="zh" selected>中文</option>
                    <option value="en">英文</option>
                </select>
            </div>
        </div>
        <div class="modal-overlay" id="feedbackOverlay">
            <div class="feedback-modal">
                <h3>反馈详情</h3>
                <p>请告诉我们您的具体想法：</p>
                <textarea class="feedback-textarea" placeholder="请输入您的反馈..."></textarea>
                <div class="modal-buttons">
                    <button class="modal-button secondary" onclick="closeFeedbackModal()">取消</button>
                    <button class="modal-button primary" onclick="submitFeedback()">提交</button>
                </div>
            </div>
        </div>
        <div class="chat-container">
            <!-- AI消息 -->
            <div class="message-wrapper">
                <img src="static/logo.jpg" alt="Logo" class="logo">
                <div class="message">
                    您好！这是畅游济南小助手，为了给您规划一个适合您的旅游行程，请告诉我你的旅行初步设想，我来帮你规划一下吧
                </div>
                <div class="typing-indicator">AI正在输入...</div>
            </div>
        </div>
        <div class="input-area">
            <div class="input-container">
                <textarea id="userInput" class="input-box" placeholder="请输入您的问题..."></textarea>
            </div>
            <div class="tools-bar">
                <div id="aiModel"
                    style="display: inline-block; border: 1px solid #ccc; padding: 4px 8px; border-radius: 4px;">
                    DeepSeek</div>
                <div class="button-group">
                    <button id="exportPdfBtn" class="export-button">导出为 PDF</button>
                    <button id="screenshotBtn" class="screenshot-button" onclick="takeScreenshot()">截图</button>
                    <button type="button" class="send-button" id="sendBtn">
                        <i class="fas fa-paper-plane"></i> 发送
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 主题切换菜单 -->
    <div class="theme-menu" id="themeMenu">
        <div class="theme-menu-item" onclick="switchToDarkTheme()">
            <i class="fas fa-moon"></i> 深色主题
        </div>
        <div class="theme-menu-item" onclick="switchToLightTheme()">
            <i class="fas fa-sun"></i> 浅色主题
        </div>
        <div class="theme-menu-item" onclick="openFileInput()">
            <i class="fas fa-image"></i> 自定义背景
        </div>
    </div>
    <input type="file" id="file-input" accept="image/*">


    <div class="right-sidebar" id="rightSidebar">
        <button class="close-btn" onclick="closeSidebar()">×</button>
        <div class="search-results" id="searchResults">
            <!-- CSV 文件将在这里动态生成内容 -->
        </div>
    </div>


    <script src="{{ url_for('static', filename='js/function.js') }}"></script>
    <script src="{{ url_for('static', filename='js/function_weather.js') }}"></script>
</body>

</html>